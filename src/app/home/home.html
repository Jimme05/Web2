<!-- 🎮 Navbar -->
<app-user-navbar [balance]="walletBalance"></app-user-navbar>

<!-- 🛍️ เนื้อหา -->
<div class="container">
  <div class="store-box">
    <h2 class="store-title">🎮 ร้านค้าเกม</h2>

    <!-- 🔍 แถวค้นหา -->
    <div class="search-row">
      <input type="text" placeholder="ค้นหาเกม..." [(ngModel)]="searchTerm" (ngModelChange)="onSearchChange()" />

      <select [(ngModel)]="selectedGenre" (change)="onGenreChange()">
        <option *ngFor="let genre of genres" [value]="genre">
          {{ genre }}
        </option>
      </select>

      <button class="btn-search" (click)="loadGames()">🔍 ค้นหา</button>
    </div>

    <!-- 🎮 รายการเกม -->
    <div class="games-grid">
      <div class="game-card" *ngFor="let g of games" (click)="showGameDetail(g)">
        <div class="game-banner">
          <img [src]="imageUrl(g.imagePath)" alt="{{ g.title }}" class="game-image" />
        </div>

        <div class="game-info">
          <h3>{{ g.title }}</h3>
          <p class="genre">🎯 {{ g.genre }}</p>
          <p class="price">💰 ฿{{ g.price }}</p>
          <div class="rank">🏅 อันดับ {{ g.rank }}</div>

          <button class="btn-cart" [ngClass]="{
    'btn-owned': alreadyOwned(g.id),
    'btn-disabled': inCart(g.id) || alreadyOwned(g.id)
  }" (click)="addToCart(g)" [disabled]="inCart(g.id) || alreadyOwned(g.id)">
            🛒
            {{ alreadyOwned(g.id)
            ? 'เป็นเจ้าของแล้ว'
            : inCart(g.id)
            ? 'อยู่ในตะกร้าแล้ว'
            : 'เพิ่มลงตะกร้า' }}
          </button>
        </div>
      </div>
    </div>

    <!-- ❌ ถ้าไม่มีเกม -->
    <div class="empty-state" *ngIf="games.length === 0">
      <p>ไม่พบเกมที่ตรงกับคำค้นหา 😢</p>
    </div>
  </div>
</div>

<!-- 🎯 การ์ดรายละเอียดเกม -->
<div class="popup-overlay" *ngIf="selectedGame" (click)="closeDetail($event)">
  <div class="popup-card" (click)="$event.stopPropagation()">
    <button class="btn-close" (click)="closeDetail()">✖</button>

    <img [src]="imageUrl(selectedGame.imagePath)" alt="{{ selectedGame.title }}" class="popup-img" />

    <div class="popup-info">
      <h2>{{ selectedGame.title }}</h2>
      <p class="genre">🎮 ประเภท: {{ selectedGame.genre }}</p>
      <p class="price">💰 ราคา: ฿{{ selectedGame.price | number }}</p>
      <p class="rank">🏅 อันดับ: {{ selectedGame.rank }}</p>
      <p class="description">📝 {{ selectedGame.description }}</p> <!-- 🔹 เพิ่ม -->
      <p class="release">📅 วันที่วางจำหน่าย: {{ selectedGame.releaseDate }}</p> <!-- 🔹 เพิ่ม -->
    </div>

    <button class="btn-cart" [ngClass]="{
    'btn-owned': alreadyOwned(selectedGame.id),
    'btn-disabled': inCart(selectedGame.id) || alreadyOwned(selectedGame.id)
  }" (click)="addToCart(selectedGame)" [disabled]="inCart(selectedGame.id) || alreadyOwned(selectedGame.id)">
      🛒
      {{ alreadyOwned(selectedGame.id)
      ? 'เป็นเจ้าของแล้ว'
      : inCart(selectedGame.id)
      ? 'อยู่ในตะกร้าแล้ว'
      : 'เพิ่มลงตะกร้า' }}
    </button>
  </div>
</div>