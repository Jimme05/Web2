<app-user-navbar [balance]="balance"></app-user-navbar>

<div class="profile-container">
  <!-- üë§ Profile Header -->
  <div class="profile-header">
    <div class="profile-info">
      <div class="profile-avatar">
        <img *ngIf="currentUser?.profileImage" [src]="imageUrl(currentUser?.profileImage)" alt="Profile"
          class="avatar-img">

        <div *ngIf="!currentUser?.profileImage" class="avatar-placeholder">üë§</div>
      </div>

      <div class="profile-details">
        <h1 class="profile-name">{{ currentUser?.name }}</h1>
        <p class="profile-email">{{ currentUser?.email }}</p>
        <div class="profile-meta">
          <span class="meta-item">
            <span class="meta-icon">üéÆ</span>
            {{ currentUser?.ownedGames?.length || 0 }} ‡πÄ‡∏Å‡∏°
          </span>
          <span class="meta-item">
            <span class="meta-icon">üìÖ</span>
            ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà {{ formatDate(currentUser?.createdAt || '') }}
          </span>
        </div>
      </div>

      <button class="btn-topup" (click)="goToEditProfile()">
        <span class="btn-icon">üõ†Ô∏è</span>
        ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß
      </button>
    </div>
  </div>

  <!-- üí∞ Wallet Section -->
  <div class="wallet-section">
    <div class="wallet-card">
      <div class="wallet-header">
        <h2 class="wallet-title">
          <span class="wallet-icon">üí≥</span>
          ‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏á‡∏¥‡∏ô
        </h2>
        <button class="btn-topup" (click)="openTopupModal()">
          <span class="btn-icon">üí∞</span>
          ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
        </button>
      </div>

      <div class="wallet-balance-card">
        <p class="balance-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
        <h3 class="balance-amount">‡∏ø{{ formatCurrency(walletBalance) }}</h3>

        <div class="wallet-stats">
          <div class="stat-item">
            <span class="stat-icon">üì•</span>
            <div class="stat-info">
              <p class="stat-label">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
              <p class="stat-value">‡∏ø{{ formatCurrency(totalTopups) }}</p>
            </div>
          </div>
          <div class="stat-divider"></div>
          <div class="stat-item">
            <span class="stat-icon">üì§</span>
            <div class="stat-info">
              <p class="stat-label">‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
              <p class="stat-value">‡∏ø{{ formatCurrency(totalPurchases) }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- üìú Transaction History -->
    <div class="transaction-section">
      <div class="transaction-header">
        <h3 class="transaction-title">
          <span class="title-icon">üìã</span>
          ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </h3>
        <div class="transaction-filters">
          <button class="filter-btn" [class.active]="transactionFilter === 'all'" (click)="setFilter('all')">
            ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          </button>
          <button class="filter-btn" [class.active]="transactionFilter === 'topup'" (click)="setFilter('topup')">
            üí∞ ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
          </button>
          <button class="filter-btn" [class.active]="transactionFilter === 'purchase'" (click)="setFilter('purchase')">
            üéÆ ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏°
          </button>
        </div>
      </div>

      <!-- Transaction List -->
      <div class="transaction-list" *ngIf="filteredTransactions.length > 0">
        <div class="transaction-item" [ngClass]="getTransactionClass(transaction.type)"
          *ngFor="let transaction of filteredTransactions">
          <div class="transaction-icon">
            {{ getTransactionIcon(transaction.type) }}
          </div>
          <div class="transaction-details">
            <h4 class="transaction-desc">{{ transaction.description }}</h4>
            <p class="transaction-date">{{ formatDate(transaction.createdAt) }}</p>
            <div class="transaction-balance-info">
              <span class="balance-before">{{ formatCurrency(transaction.balanceBefore) }}</span>
              <span class="arrow">‚Üí</span>
              <span class="balance-after">{{ formatCurrency(transaction.balanceAfter) }}</span>
            </div>
          </div>
          <div class="transaction-amount" [class.topup]="transaction.type === 'topup'">
            <span class="amount-sign">{{ transaction.type === 'topup' ? '+' : '-' }}</span>
            ‡∏ø{{ formatCurrency(transaction.amount) }}
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="filteredTransactions.length === 0">
        <div class="empty-icon">üì≠</div>
        <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h3>
        <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏Å‡∏°‡∏Å‡∏±‡∏ô‡πÄ‡∏ñ‡∏≠‡∏∞!</p>
      </div>
    </div>
  </div>
</div>

<!-- üí∞ Topup Modal -->
<div class="modal-overlay" [class.active]="isTopupModalOpen" (click)="closeModalOnOverlay($event)">
  <div class="topup-modal" (click)="$event.stopPropagation()">
    <button class="close-btn" (click)="closeTopupModal()">&times;</button>

    <div class="modal-header">
      <div class="modal-icon">üí∞</div>
      <h2>‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</h2>
      <p class="modal-subtitle">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏°</p>
    </div>

    <div class="modal-body">
      <!-- Current Balance -->
      <div class="current-balance">
        <span class="balance-label">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</span>
        <span class="balance-value">‡∏ø{{ formatCurrency(walletBalance) }}</span>
      </div>

      <!-- Quick Amount Buttons -->
      <div class="quick-amounts">
        <button *ngFor="let amount of quickAmounts" class="amount-btn" [class.selected]="selectedAmount === amount"
          (click)="selectQuickAmount(amount)">
          <span class="amount-icon">üíµ</span>
          <span class="amount-text">‡∏ø{{ formatCurrency(amount) }}</span>
        </button>
      </div>

      <!-- Custom Amount Input -->
      <div class="custom-amount-section">
        <label for="customAmount">‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏≠‡∏á</label>
        <div class="custom-input-wrapper">
          <span class="currency-symbol">‡∏ø</span>
          <input type="number" id="customAmount" [(ngModel)]="customAmount" (ngModelChange)="onCustomAmountChange()"
            placeholder="0" min="1">
        </div>
      </div>

      <!-- Summary -->
      <div class="topup-summary" *ngIf="selectedAmount > 0">
        <div class="summary-row">
          <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡∏¥‡∏°</span>
          <span class="summary-value">‡∏ø{{ formatCurrency(selectedAmount) }}</span>
        </div>
        <div class="summary-divider"></div>
        <div class="summary-row total">
          <span>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏¥‡∏°</span>
          <span class="summary-value highlight">‡∏ø{{ formatCurrency(walletBalance + selectedAmount) }}</span>
        </div>
      </div>

      <!-- Confirm Button -->
      <button class="btn-confirm" [disabled]="selectedAmount <= 0" (click)="confirmTopup()">
        <span class="btn-shine"></span>
        <span *ngIf="selectedAmount > 0">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô ‡∏ø{{ formatCurrency(selectedAmount) }}</span>
        <span *ngIf="selectedAmount <= 0">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span>
      </button>
    </div>
  </div>
</div>