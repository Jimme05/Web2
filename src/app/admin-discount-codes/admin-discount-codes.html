<app-admin-navbar></app-admin-navbar>

<div class="container">
  <div class="dashboard-box">
    <h2 class="dashboard-title">
      üí≥ {{ editing ? '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î' : '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î' }}
    </h2>

    <form class="coupon-form" (ngSubmit)="saveCoupon()">
      <!-- ü™™ ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á -->
      <div class="form-group">
        <label>ü™™ ‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á</label>
        <input
          type="text"
          placeholder="‡πÄ‡∏ä‡πà‡∏ô GAME2025"
          [(ngModel)]="couponName"
          name="couponName"
          required
          [readonly]="editing"
        />
      </div>

      <!-- üéØ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
      <div class="form-group">
        <label>üéØ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô)</label>
        <input
          type="number"
          min="1"
          placeholder="‡πÄ‡∏ä‡πà‡∏ô 10"
          [(ngModel)]="usageLimit"
          name="usageLimit"
          required
        />
      </div>

      <!-- üë§ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ -->
      <div class="form-group">
        <label>üë§ ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÄ‡∏ä‡πà‡∏ô 1 = ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ö‡∏±‡∏ç‡∏ä‡∏µ)</label>
        <input
          type="number"
          min="1"
          placeholder="1"
          [(ngModel)]="perUserLimit"
          name="perUserLimit"
        />
      </div>

      <!-- üí∞ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î -->
      <div class="form-group">
        <label>üí∞ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</label>
        <div class="inline">
          <input
            type="number"
            min="1"
            [max]="isPercent ? 100 : null"
            placeholder="‡πÄ‡∏ä‡πà‡∏ô 15"
            [(ngModel)]="discountPercent"
            name="discountPercent"
            required
          />
          <label class="toggle">
            <input type="checkbox" [(ngModel)]="isPercent" name="isPercent" />
            <span>{{ isPercent ? '% ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå' : '‡∏ø ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' }}</span>
          </label>
        </div>
      </div>

      <button class="btn-create" type="submit" [disabled]="loading">
        {{ loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : (editing ? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç' : '‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á') }}
      </button>

      <button
        *ngIf="editing"
        type="button"
        class="btn-cancel"
        (click)="cancelEdit()"
      >
        ‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
      </button>
    </form>

    <!-- üîπ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á -->
    <h3 class="sub-title">üéüÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î</h3>

    <div class="coupon-list" *ngIf="coupons.length > 0; else emptyCoupon">
      <div class="coupon-item" *ngFor="let c of coupons">
        <div>
          <h4>{{ c.code }}</h4>
          <p>
            ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î:
            <strong>
              {{ c.isPercent ? (c.amount + '%') : ('‡∏ø' + c.amount) }}
            </strong>
            |
            ‡πÉ‡∏ä‡πâ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß: {{ c.usedCount || 0 }}
            / {{ c.maxUses ?? '‚àû' }}
          </p>
          <p>‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: {{ c.perUserLimit ?? '‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î' }}</p>
          <p class="dates">
            ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤:
            {{ c.startAt || '-' }} ‚Üí {{ c.endAt || '-' }}
          </p>
          <p *ngIf="c.minOrderAmount">
            ‡∏¢‡∏≠‡∏î‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥: ‡∏ø{{ c.minOrderAmount }}
          </p>
        </div>

        <div class="actions">
          <button class="btn-edit" (click)="editCoupon(c)">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button class="btn-delete" (click)="deleteCoupon(c)">üóëÔ∏è ‡∏•‡∏ö</button>
        </div>

        <span class="status" [class.active]="c.isActive">
          {{ c.isActive ? '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà' : '‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' }}
        </span>
      </div>
    </div>

    <ng-template #emptyCoupon>
      <p class="empty-text">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö üòÖ</p>
    </ng-template>
  </div>
</div>
